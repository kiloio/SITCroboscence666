# 一阶段

## 目标

1. 实现小车移动

## 硬件详解

参照 [硬件构成](./硬件构成.md)

## 软件的实现思路

1. 保留驱动板代码，舍弃RDK X3代码
2. 查找上下位机通讯协议
3. 构建数据帧
4. 将移动的数据帧发送给运动控制板
5. 机器人移动

## 数据帧详解

参照 [数据帧](./数据帧.md)

## 代码实现

1. 建立串口连接
2. 构建数据帧
3. 通过串口发送数据帧
4. 车辆移动
5. 关闭串口连接
6. 结束

**构建串口并连接**

```python
ser = serial.Serial(port = "/dev/ttyS3", baudrate = 115200, timeout=0.1)
```

**构建数据帧**

```python
frame = [0x55, 0x01, 0x06, 0xFF, 0x05, 0x00, 0x00, 0x03, 0x00, 0x07, 0xBB]
frame = bytes(frame)
```

**通过串口发送数据帧**

```python
ser.write(frame)
```

**车辆移动**

```python
time.sleep(2)
```

**关闭串口连接**

```python
ser.close()
```

**整合**

```python
import serial
import time

ser = serial.Serial(port = "/dev/ttyS3", baudrate = 115200, timeout=0.1)
frame = [0x55, 0x01, 0x06, 0xFF, 0x05, 0x00, 0x00, 0x03, 0x00, 0x07, 0xBB]
frame = bytes(frame)
ser.write(frame)
time.sleep(2)
ser.close()
```
**ps：** 机器人不停为正常现象，发送速度为0的数据帧即可

## 代码使用方法

### RobotController类介绍

```py
rc = RobotController(port="/dev/ttyS3", baudrate=115200)
    """
    实例化对象，传入参数为串口端口与波特率
    ps：RDK X3 40PIN 上的串口为/dev/ttyS3，若改用其他开发板或串口，则需更改此处
    """
def send_speed_control(left_mm_s: int, right_mm_s: int)
    """
    发送速度控制命令
    参数：
        left_mm_s: 左轮速度（mm/s，带符号）
        right_mm_s: 右轮速度（mm/s，带符号）
    函数实现思路：
        1. 解析左右轮速度，按照通信协议构建数据帧
        2. 发送此数据帧
    """

def send_device_control(self, led_enable: int, led_state: int,
                        buz_enable: int, buz_state: int,
                        imu_enable: int, imu_state: int) -> bool:
    """
    发送LED、蜂鸣器、IMU校准控制命令
    参数：
        led_enable: LED使能字段
        led_state:  LED状态字段
        buz_enable: 蜂鸣器使能字段
        buz_state:  蜂鸣器状态字段
        imu_enable: IMU校准使能字段
        imu_state:  IMU校准状态字段
    函数实现思路：
        1. 构建数据帧并发送
    """
```

**ps:** 在RobotController类中，主要用send_speed_control函数。